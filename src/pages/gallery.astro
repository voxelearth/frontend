---
import Layout from "~/layouts/Layout.astro";
import Section from "~/components/Section.astro";
import Heading from "~/components/Heading.astro";
import { Picture } from "astro:assets";
import { getCollection } from "astro:content";
import { discord } from "~/data/config";

const gallery = await getCollection("gallery");
const offsetClasses = ["lg:-translate-y-3", "lg:translate-y-4", "lg:-translate-y-5", "lg:translate-y-2", "lg:-translate-y-2"];
const decoratedGallery = gallery.map((item, index) => ({
	...item,
	offsetClass: offsetClasses[index % offsetClasses.length],
	cardTone: index % 2 === 0 ? "from-white to-emerald-50" : "from-rose-50 to-white",
}));

const floatingItems = [
	{ src: "/imgs/items/cake.png", size: "h-12 w-12 md:h-14 md:w-14", className: "top-6 left-[12%] rotate-[-6deg]" },
	{ src: "/imgs/items/compass-down.png", size: "h-11 w-11 md:h-12 md:w-12", className: "top-24 right-[18%] rotate-[10deg]" },
	{ src: "/imgs/items/book-enchanted.png", size: "h-10 w-10 md:h-12 md:w-12", className: "top-1/2 left-6 -translate-y-1/2 rotate-[4deg]" },
	{ src: "/imgs/items/apple-golden.png", size: "h-9 w-9 md:h-11 md:w-11", className: "bottom-16 left-[32%] rotate-[-12deg]" },
	{ src: "/imgs/items/map-empty.png", size: "h-12 w-12 md:h-14 md:w-14", className: "bottom-8 right-[12%] rotate-[6deg]" },
	{ src: "/imgs/items/clock-day.png", size: "h-10 w-10 md:h-12 md:w-12", className: "top-[68%] right-[32%] rotate-[-3deg]" },
	{ src: "/imgs/items/flower-pot.png", size: "h-9 w-9 md:h-11 md:w-11", className: "top-[30%] left-[45%] rotate-[8deg]" },
	{ src: "/imgs/items/emerald.png", size: "h-8 w-8 md:h-10 md:w-10", className: "bottom-[22%] right-[40%] rotate-[14deg]" },
];

const accentItems = ["book-enchanted.png", "compass-down.png", "apple-golden.png", "map-empty.png"];

const pageMeta = {
	title: "Gallery",
	pageTitle: "Gallery | Voxel Earth",
	description: "Screenshots and renders from the Voxel Earth pipeline showcasing photogrammetry rebuilt as Minecraft worlds.",
};
---

<Layout title={pageMeta.title} pageTitle={pageMeta.pageTitle} description={pageMeta.description}>
  <Section class:list={"[&>.container]:pb-0"}>
    <Heading>
      <h1 slot="heading-title" class="font-black text-brand-green h2">Voxel Earth Gallery</h1>
      <p slot="heading-content">
        Glimpse some in-game screenshots and renders of the voxelized world. 
        Each image highlights iconic places now possible to visit at <code>play.voxelearth.org</code>.
      </p>
    </Heading>
  </Section>

  <Section class="relative bg-[#f4fbf4] py-16 lg:py-24 overflow-hidden">
    <div class="pointer-events-none absolute inset-0">
      {floatingItems.map((item) => (
        <img
          src={item.src}
          class={`float-bob pixel-art absolute opacity-90 drop-shadow-lg ${item.size ?? "h-10 w-10"} ${item.className}`}
          alt=""
          loading="lazy"
          aria-hidden="true"
        />
      ))}
    </div>
    <div class="relative mx-auto max-w-6xl">
      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {decoratedGallery.map((item, index) => (
          <div
            class={`group relative flex h-full flex-col rounded-[32px] border border-emerald-100/60 bg-gradient-to-br ${item.cardTone} p-5 shadow-[0_18px_45px_rgba(15,73,55,0.08)] transition duration-300 hover:-translate-y-1.5 ${item.offsetClass}`}
          >
            <a href={item.data.image.src} class="glightbox block">
              <div class="relative w-full overflow-hidden rounded-[24px] bg-white/40" style="aspect-ratio: 4 / 3;">
                <Picture
                  src={item.data.image}
                  alt={item.data.alt}
                  class="block h-full w-full object-cover transition duration-500 group-hover:scale-[1.03]"
                  loading={index < 3 ? "eager" : "lazy"}
                  fetchpriority={index < 3 ? "high" : "auto"}
                />
              </div>
            </a>
            <div class="mt-5 flex items-center justify-between text-sm text-slate-500">
              <div>
                <p class="text-xs uppercase tracking-[0.35em] text-brand-green/70">Snapshot</p>
                <p class="text-base font-semibold text-slate-800">{item.data.title.replace(/-/g, " ")}</p>
              </div>
              <img
                src={`/imgs/items/${accentItems[index % accentItems.length]}`}
                alt=""
                class="pixel-art h-9 w-9 opacity-90 drop-shadow"
                loading="lazy"
                aria-hidden="true"
              />
            </div>
          </div>
        ))}
      </div>
    </div>
  </Section>

  <Section class="bg-white">
    <div class="mx-auto flex max-w-5xl flex-col gap-8 rounded-[36px] border border-rose-100 bg-gradient-to-br from-rose-50 via-white to-emerald-50 p-10 shadow-[0_24px_60px_rgba(0,0,0,0.08)] lg:flex-row lg:items-center lg:justify-between">
      <div class="max-w-2xl">
        <p class="text-xs font-semibold uppercase tracking-[0.45em] text-rose-500/80">Share your adventure</p>
        <h2 class="mt-3 text-3xl font-black text-slate-900">Submit screenshots, captions, or tiny stories</h2>
        <p class="mt-4 text-lg leading-relaxed text-slate-600">
          Have a favorite skyline, castle, or cozy street you explored in Voxel Earth? Send us your screenshot and a short caption.
          Our team reviews submissions manually so the gallery stays curated and magical. We’ll let you know if your shot makes the next update.
        </p>
      </div>
      <div class="flex flex-col gap-4">
        <a
          href={discord.href}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center rounded-full bg-brand-green px-8 py-3 text-base font-semibold uppercase tracking-[0.25em] text-white shadow-lg transition hover:bg-brand-green/90"
        >
          Submit via Discord
        </a>
        <a
          href="/contact"
          class="inline-flex items-center justify-center rounded-full border border-brand-green/40 bg-white px-8 py-3 text-base font-semibold uppercase tracking-[0.2em] text-brand-green shadow-sm transition hover:border-brand-green"
        >
          Contact Us
        </a>
      </div>
    </div>
  </Section>
</Layout>

<script>
  import GLightbox from "glightbox";
  import "../../node_modules/glightbox/dist/css/glightbox.min.css";

  document.addEventListener("astro:page-load", () => {
    const lightbox = GLightbox({
      touchNavigation: true,
      autoplayVideos: true,
      loop: true,
      draggable: true,
    });
  });
</script>

